

========================================================================

      ＱＫＣ − Quick KANJI code Converter  C Version 1.0

      取扱説明書

      Copyright (C) 1992 by K.Sato
      All rights reserved.

========================================================================




◆ はじめに
-----------

  この度は、『QKC』をご利用いただきまして、誠にありがとうございます。
  日本語の文字コード体系として、現在主に JISコード、シフトJISコード、EUC
の３種類の漢字コードがあり、UNIX では EUC と JISコードが、 MS-DOS や MS-
Windows ではシフトJISコードがよく用いられています。『QKC』はテキストファ
イル中のそれらの漢字コードを相互に変換します。
  是非、この小さなプログラムをご利用下さい。



◆ 使用法
---------

◇ 書式    qkc [options] [filenames]

  filenames は１個以上のターゲットファイルの名前、options は動作を指定す
るための０個以上のオプションパラメータです。１つの option は、マイナス記
号(-)とそれに続く文字列から成ります。filenames と options はスペースかタ
ブで区切って指定しますが、 options はマイナス記号(-)に続けて複数連結して
指定することもできます。ターゲットファイルを１個も指定しない場合、標準入
力から入力し標準出力に出力するフィルタとして動作します。

◇ 出力漢字コード指定オプション

    -s  (to Shift-JIS)
        シフトJISコードに変換します。

    -e  (to EUC)
        EUC に変換します。

    -j  (to JIS)
        JISコードに変換します。

    -bj (to '(B'-JIS)
        JISコードに変換します。ただし、-j オプション時とは違うエスケープ
        シーケンスが使われます。

    -oj (to Old-JIS)
        旧JISコードに変換します。

    -nj (to NEC-JIS)
        NEC JISコードに変換します。

      上記の６つのオプションは排他的で、複数指定された場合、一番最後のも
    のが有効になります。デフォルトは UNIX では -e、MS-DOS では -s です。

◇ 入力漢字コード指定オプション

    -i? (Input KANJI code)
        入力ファイルの漢字コードを強制的に設定します。このオプションを指
        定すると、漢字コードの自動判別、バイナリファイルの自動判別は行わ
        れなくなります。使用には十分注意して下さい。? には、次の３種類が
        指定可能です。

        -is   入力ファイルの漢字コードをシフトJISコードとみなします。
        -ie   入力ファイルの漢字コードを EUC とみなします。
        -ij   入力ファイルの漢字コードを JISコードとみなします。

◇ 標準入出力オプション

    -O  (Output to stdout)
        元のファイルは書き換えずに、標準出力（stdout）に出力します。標準
        出力がファイルにリダイレクトされているときは自動的にこのオプショ
        ンが指定されているとみなします。

    -I  (Input from stdin)
        標準入力（stdin）から入力します。 ターゲットファイルが指定されて
        いないときは自動的にこのオプションが付加されます。このオプション
        を指定すると、自動的に -O オプションも指定されたものとして、出力
        先は標準出力になり、フィルタとして動作します。

◇ 改行コード変換オプション

    -m  (MS-DOS type)
        改行コードを CR LF（0Dh 0Ah）にします。

    -u  (UNIX type)
        改行コードを LF（0Ah）にします。

    -ma (Mac type)
        改行コードを CR（0Dh）にします。

      上記の３つのオプションは排他的で、複数指定された場合、一番最後のも
    のが有効になります。何も指定がない場合、改行コードの変換は行われませ
    ん。

◇ その他のオプション

    -7  (7 bit mode)
        7ビットJISコードを指定します。7ビットJISコードとは、半角カナ文字
        の最上位ビットを０にマスクすると共に前後に SO（0Eh）、 SI（0Fh）
        コードが挿入されているコードのことです。なお、このオプションは、
        -j, -bj, -oj, -nj オプションのいずれかが指定されているとき、ある
        いは入力側が JISコードのときに有効です。

    -z  (Remove ^Z)
        ファイルの最後に ^Z が付いている場合 ^Z を取り除きます。 UNIX で
        出力先が標準出力の場合、このオプションは無視されます。

    -q  (Quiet mode)
        エラーメッセージ以外の情報の表示を抑制します。

    -h  (Show help)
        書式と主要なオプションの要約を示すヘルプ画面を表示します。

    -H  (Show detailed help)
        書式とオプションの要約を示すヘルプ画面を表示します。



◆ 使用法（nkf エミュレーションモード）
---------------------------------------

◇ 書式    qkc -nkf [options] [filenames]

  QKC C Version には nkf と同等の動作をする nkf エミュレーションモードが
あります。nkf Version 1.4 のほとんどの機能をサポートしています。 options
と filenames は nkf の指定方法に準じます。
    alias nkf 'qkc -nkf'
としてご利用されることをお勧めします。

◇ オプション

  nkf エミュレーションモードでは、以下のオプションをサポートしています。
各オプションの意味については、nkf のドキュメントを参照して下さい。

    -j, -n, -s, -x, -e, -a, -t, -i?, -o?, -BJ, -J, -BB, -r, -v



◆ 一般的な使用例
-----------------

  QKC は、指定したファイルの漢字コードを指定した漢字コードに変換します。
通常は、ファイルそのものを変換しますが、元のファイルを書き換えたくない場
合は、 -O オプションを指定するか、ファイルにリダイレクトすれば、自動的に
標準出力に出力するようになっています。
  一般的な使用においては、漢字コードを指定する -s, -e, -j オプション、改
行コードを変換する必要があるときは、 -m, -u オプションを覚えておけば十分
です。
  以下に例を示します。

◇ *.doc と *.txt を EUC に変換する場合
    qkc -e *.doc *.txt

◇ mbox をシフトJISコードに変換し改行コードを CR LF にする場合
    qkc -sm mbox

◇ qkc.doc を JISコードに変換して foo に出力する場合
    qkc -j qkc.doc > foo

◇ foo を EUC に変換して画面に表示する場合
    qkc -eO foo

◇ シフトJISコードに変換するフィルタとして使う場合
    cat foo | qkc -s



◆ 漢字コードの自動判別
-----------------------

  QKC は変換をする前に、まず、入力ファイルで使われている漢字コードを自動
判別します。このため、通常は出力する漢字コードを指定するだけでよく、入力
ファイルの漢字コードを明示的に指定する必要はありません。 ただし、JISコー
ドが 7ビットJISコードの場合は、あえて -7 オプションを指定します。
  自動判別の結果、変換の必要がなく、改行コードを指定していないときは処理
はスキップされます。ただし、出力先が標準出力の場合は、無変換のまま出力さ
れます。また、極めて稀ですが、ファイルを変換する場合で漢字コードが同定で
きないときも処理はスキップされます。
  QKC は大抵のテキストファイルでは正常に自動判別しますが、初めて出現する
漢字コードよりも前に多数の半角カナ文字が存在する場合、自動判別できないこ
とがあります。この場合、-i? オプションを使用して下さい。



◆ バイナリファイルの判別
-------------------------

  QKC は、誤ってバイナリファイルを変換してしまわないようにするために、テ
キストファイルとバイナリファイルを自動判別します。入力ファイルに、無効な
漢字コードやテキストファイルでの出現頻度が低い制御文字 （ 00h〜06h, 0Bh,
10h〜19h, 1Ch〜1Fh）が多数含まれる場合、バイナリファイルである可能性が高
いと判断し、処理はスキップされます。ただし、出力先が標準出力の場合は、無
変換のまま出力されます。強制的に変換する場合は、-i? オプションを使用して
下さい。



◆ JIS 系コードのエスケープシーケンス
-------------------------------------

  JIS 系コード（JIS、旧JIS、NEC JIS） で使われるエスケープシーケンスは以
下のようになっています。

◇ 入力時

      入力時は、JIS、旧JIS、NEC JIS に関わらず、以下のものを漢字や１バイ
    ト英数文字を指示するエスケープシーケンスとして受け付けます。

    漢字指示              {ESC,'$B'}, {ESC,'$@'}, {ESC,'K'}
    １バイト英数文字指示  {ESC,'(J'}, {ESC,'(B'}, {ESC,'(H'}, {ESC,'H'}

◇ 出力時

                           JIS (-j)    JIS (-bj)    旧JIS      NEC JIS
    -------------------------------------------------------------------
    漢字指示              {ESC,'$B'}  {ESC,'$B'}  {ESC,'$@'}  {ESC,'K'}
    １バイト英数文字指示  {ESC,'(J'}  {ESC,'(B'}  {ESC,'(J'}  {ESC,'H'}



◆ テンポラリファイル
---------------------

  QKC は、ファイルを変換する場合、そのファイルが存在するディレクトリにテ
ンポラリファイルを作成します。したがって、そのディレクトリに書き込み許可
が必要です。



◆ 環境変数
-----------

  環境変数 QKC  に定常的に使用するオプションのリストを登録しておくことが
できます。 環境変数 QKC に登録されているオプションは、実際のコマンドライ
ン引数の前に挿入されて処理されます。
  例を示します。ここでは、出力漢字コードを EUC、改行コードを LF にするオ
プションを指定しています。
    setenv QKC -eu
ここで、コマンドラインで次のようにタイプしたとすると、
    qkc *.txt
QKC は、次のようにタイプしたかのように動作します。
    qkc -eu *.txt



◆ QKC の名称について
---------------------

  QKC は、まず MS-DOS 上の Turbo Pascal で開発され、 後に C言語 に移植さ
れました。Pascal版では QKC（Quick KANJI code Converter）の名の通り、漢字
コードの高速変換を目的として MS-DOS 用に最適化され、他の類似プログラムの
追随を許さない変換速度を実現しています。ただし、この C版においてはポータ
ビリティを優先したため必ずしもその限りではありませんが、QKC という名称だ
けは両者で統一しています。



◆ 無保証
---------

  本ソフトウェアの使用による如何なる損害についても、作者はその責任を負い
ません。しかし、アルゴリズムは信頼でき、それほど多くのバグが存在するとは
思えないことは保証します。



◆ 著作権・配布・転載について
-----------------------------

  本ソフトウェアに関する一切の権利は、佐藤公彦が保有しています。著作権を
侵害する行為はご遠慮下さい。

  配布・転載は制限しておりません。ただし、以下の条件があります。

  ・パッケージに含まれるすべてのファイルをセットにして下さい。
  ・一切、改変を加えないで下さい。
  ・本ソフトウェアを使用したことによって生じた損害は全く保証しません。



◆ 参考文献
-----------

  ・プログラミング言語 C 第2版（共立出版）
  ・UNIX C プログラミング（アスキー出版局）
  ・Standard C プログラマーズリファレンス（アスキー出版局）
  ・The UNIX Super Text 【上】（技術評論社）
  ・ユーザーズ UNIX（岩波書店）



◆ 改版履歴
-----------

◇ Ver 0.1 (94/12/6)

  ・試作版

◇ Ver 0.2 (94/12/8)

  ・細かい不具合を修正しました。

◇ Ver 0.3 (94/12/19)

  ・細かい不具合を修正しました。

◇ Ver 1.0 (95/10/1)

  ・一般公開。
  ・ドキュメント類を整備しました。
  ・漢字コード変換アルゴリズムを変更しました。
  ・その他、細かい修正をしました。



◆ おわりに
-----------

  本プログラムの作成にあたって協力していただいた諸氏に対する感謝の意を表
します。この小さなプログラムが少しでも皆様のお役に立てれば幸いです。

                                                         1995年 10月 1日

                                                                佐藤公彦



◆ 作者
-------

東京大学工学部電子情報工学科
佐藤公彦(K.Sato)

NIFTY-Serve : JBG03513
PC-VAN      : FDF90332
Internet    : sato@sail.t.u-tokyo.ac.jp

